<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ecuador Trivia Journey</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=DM+Serif+Display&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <div class="floating-bg" aria-hidden="true"></div>
    <header class="app-header">
      <div class="brand">
        <div class="brand-mark" aria-hidden="true">EC</div>
        <div>
          <p class="overline">Andes-Amazon route</p>
          <h1>Ecuador Trivia Journey</h1>
        </div>
      </div>
      <div class="hud" aria-live="polite">
        <div><span class="hud-label">Player</span><span id="hud-player"></span></div>
        <div><span class="hud-label">Money</span><span id="hud-player-money">$0</span></div>
        <div><span class="hud-label">AI Rival</span><span id="hud-ai-money">$0</span></div>
        <div><span class="hud-label">Level</span><span id="hud-level">-</span></div>
        <button id="back-to-map" class="ghost" aria-label="Back to map" title="Back to map">Map</button>
      </div>
    </header>

    <main>
      <!-- Start -->
      <section id="start-screen" class="screen active" aria-label="Start screen">
        <div class="start-card glass">
          <div class="start-visual" aria-hidden="true">
            <div class="sun"></div>
            <div class="mountain"></div>
            <div class="leaf leaf-left"></div>
            <div class="leaf leaf-right"></div>
            <div class="wave wave-1"></div>
            <div class="wave wave-2"></div>
          </div>
          <div class="start-body">
            <p class="overline">Ready to play</p>
            <h2>Choose your nickname and settings</h2>
            <form id="start-form">
              <label for="nickname" class="field-label">Nickname (max 20 characters)</label>
              <input id="nickname" name="nickname" type="text" maxlength="20" required aria-required="true" autocomplete="off" placeholder="Explorer" />
              <div class="settings-grid">
                <label class="toggle">
                  <input type="checkbox" id="sfx-toggle" checked>
                  <span>Sound effects</span>
                </label>
                <label class="toggle">
                  <input type="checkbox" id="music-toggle" checked>
                  <span>Ambient / music</span>
                </label>
                <label class="toggle">
                  <input type="checkbox" id="theme-toggle">
                  <span>Dark theme</span>
                </label>
                <label class="toggle">
                  <input type="checkbox" id="contrast-toggle">
                  <span>High contrast</span>
                </label>
                <label class="toggle">
                  <input type="checkbox" id="motion-toggle">
                  <span>Reduce motion</span>
                </label>
              </div>
              <div class="actions-row">
                <button type="button" id="clear-progress" class="ghost" aria-label="Clear saved progress">Clear progress</button>
                <button type="submit" id="play-btn" class="primary" aria-label="Play now">Play</button>
              </div>
              <p class="mini-note">No narration. Sounds can be muted anytime.</p>
            </form>
          </div>
        </div>
      </section>

      <!-- Intro -->
      <section id="intro-screen" class="screen" aria-label="Introduction and rules">
        <div class="intro-wrapper glass">
          <div class="intro-steps">
            <div class="intro-card active" data-step="1">
              <div class="narrator">
                <div class="bubble">Welcome! Travel across Ecuador answering $200, $400, and $600 clues. Earn more money than the AI rival.</div>
              </div>
              <p>Cities unlock in order. Each tile can be played once; correct answers add money, incorrect answers subtract.</p>
            </div>
            <div class="intro-card" data-step="2">
              <div class="narrator">
                <div class="bubble">The AI also plays: it “thinks”, prefers higher values, and succeeds based on configurable probabilities.</div>
              </div>
              <p>Your progress stays in the browser: scores, unlocked cities, settings, and answered tiles persist after refresh.</p>
            </div>
            <div class="intro-card" data-step="3">
              <div class="narrator">
                <div class="bubble">Practice: try the sample question before starting.</div>
              </div>
              <div class="practice" role="group" aria-label="Practice question">
                <div class="question-line" id="practice-question"></div>
                <div class="answers">
                  <button class="chip" data-practice="a"></button>
                  <button class="chip" data-practice="b"></button>
                  <button class="chip" data-practice="c"></button>
                </div>
                <div id="practice-feedback" class="mini-note" aria-live="polite"></div>
              </div>
            </div>
          </div>
          <div class="intro-controls">
            <div id="intro-progress" aria-hidden="true"></div>
            <button id="next-intro" class="primary">Next</button>
          </div>
        </div>
      </section>

      <!-- Map -->
      <section id="map-screen" class="screen" aria-label="Map of Ecuador and levels">
        <div class="map-panel glass">
          <div class="map-header">
            <div>
              <p class="overline">Explore the map</p>
              <h2>Levels: Quito -> Baños -> Cuenca</h2>
            </div>
            <div class="map-legend">
              <span class="legend-item"><span class="dot unlocked"></span>Unlocked</span>
              <span class="legend-item"><span class="dot locked"></span>Locked</span>
              <span class="legend-item"><span class="dot complete"></span>Completed</span>
            </div>
          </div>
          <div class="map-wrapper">
            <svg id="ecuador-map" viewBox="0 0 420 520" role="img" aria-label="Stylized map of Ecuador">
              <defs>
                <linearGradient id="mapGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" stop-color="#1e7350"/>
                  <stop offset="100%" stop-color="#0f3e2d"/>
                </linearGradient>
              </defs>
              <path d="M120,60 L250,90 L310,200 L280,360 L160,480 L70,380 L80,200 Z" fill="url(#mapGradient)" opacity="0.4" stroke="#0f3e2d" stroke-width="2"></path>
              <line id="line-1-2" x1="170" y1="210" x2="200" y2="320" class="map-line dashed"></line>
              <line id="line-2-3" x1="200" y1="320" x2="190" y2="430" class="map-line dashed"></line>
              <g id="city-1" class="city-node" tabindex="0" role="button" aria-label="Quito, level 1" transform="translate(160 190)">
                <circle r="14" class="city-circle"></circle>
                <text y="36" class="city-label">Quito</text>
              </g>
              <g id="city-2" class="city-node locked" tabindex="-1" role="button" aria-label="Baños, level 2 locked" transform="translate(200 310)">
                <circle r="14" class="city-circle"></circle>
                <text y="36" class="city-label">Baños</text>
              </g>
              <g id="city-3" class="city-node locked" tabindex="-1" role="button" aria-label="Cuenca, level 3 locked" transform="translate(190 420)">
                <circle r="14" class="city-circle"></circle>
                <text y="36" class="city-label">Cuenca</text>
              </g>
            </svg>
          </div>
        </div>
      </section>

      <!-- Board -->
      <section id="board-screen" class="screen" aria-label="Question board">
        <div class="board-panel glass">
          <div class="board-header">
            <div>
              <p class="overline">Categories</p>
              <h2 id="board-title">Board</h2>
            </div>
            <div class="timers">
              <div class="timer" aria-live="polite">Time: <span id="timer-value">--</span>s</div>
              <div class="note" id="mode-note">You can answer with text or multiple choice.</div>
            </div>
          </div>
          <div id="board-grid" class="board-grid" role="grid" aria-label="Jeopardy board"></div>
        </div>
      </section>

      <!-- Question modal -->
      <div id="question-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="question-title">
        <div class="modal-content glass">
          <div class="modal-header">
            <h3 id="question-title">Question</h3>
            <button id="close-question" class="ghost" aria-label="Close question">Esc</button>
          </div>
          <div id="question-text" class="question-text" aria-live="polite"></div>
          <div class="answer-modes" role="tablist">
            <button class="chip" data-mode="text" aria-selected="true">Quick text</button>
            <button class="chip" data-mode="choice" aria-selected="false">Multiple choice</button>
          </div>
          <div class="mode mode-text">
            <label class="field-label" for="text-answer">Your answer</label>
            <input id="text-answer" type="text" autocomplete="off">
          </div>
          <div class="mode mode-choice hidden" id="choice-container" role="radiogroup" aria-label="Answer options"></div>
          <div class="modal-actions">
            <button id="submit-answer" class="primary">Submit</button>
            <button id="give-up" class="ghost">Pass</button>
          </div>
          <div id="question-feedback" class="mini-note" aria-live="polite"></div>
        </div>
      </div>

      <!-- Feedback drawer -->
      <div id="feedback-bar" class="feedback-bar" aria-live="polite"></div>

      <!-- End game -->
      <section id="end-screen" class="screen" aria-label="End of game">
        <div class="end-card glass">
          <div class="end-visual" aria-hidden="true">
            <div class="firework fw1"></div>
            <div class="firework fw2"></div>
            <div class="firework fw3"></div>
          </div>
          <div class="end-body">
            <p class="overline">Journey complete</p>
            <h2>Great game!</h2>
            <div class="stats-grid">
              <div><span class="hud-label">Player money</span><strong id="final-player"></strong></div>
              <div><span class="hud-label">AI money</span><strong id="final-ai"></strong></div>
              <div><span class="hud-label">Correct</span><strong id="final-correct"></strong></div>
              <div><span class="hud-label">Incorrect</span><strong id="final-wrong"></strong></div>
              <div><span class="hud-label">Biggest tile</span><strong id="final-best"></strong></div>
              <div><span class="hud-label">Fastest answer</span><strong id="final-fastest"></strong></div>
              <div><span class="hud-label">Time played</span><strong id="final-time"></strong></div>
            </div>
            <div class="actions-row">
              <button id="replay" class="primary">Play again</button>
              <button id="restart-map" class="ghost">Back to map</button>
              <button id="share" class="ghost">Share</button>
              <button id="download-json" class="ghost">Download summary</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="toast" role="status" aria-live="polite"></div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
